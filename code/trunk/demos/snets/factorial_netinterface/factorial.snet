<?xml version="1.0"?>
<metadata xmlns="snet-home.org" >
  <net name="factorial" >
     <observer data="full" type="before" />
     <observer data="full" type="after" interactive="true" />
  </net>
  <net name="factorial/compute" >
     <observer data="full" type="before" interactive="true" />
  </net>
</metadata>

<?xml version="1.0"?>
<metadata xmlns="snet-home.org" >
  <interface name="C4SNet" default="true" />
</metadata>


net factorial({x} -> {x,<stop>})
{

	<?xml version="1.0"?>
	<metadata xmlns="snet-home.org" >
  	    <box name="leq1" >
		<interface name="C4SNet" />
     	        <compiler>gcc</compiler>
		<compilerflags>-c -I. -I../../interfaces/C/</compilerflags>
		<boxsource>leq1.c myfuns.c</boxsource>
  	    </box>
  	    <box name="condif" >
		<compiler>gcc</compiler>
		<compilerflags>-c -I. -I../../interfaces/C/</compilerflags>
		<boxsource>condif.c myfuns.c</boxsource>
  	    </box>
	</metadata>

        box leq1( (x) -> (x,p));
        box condif( (p) -> (<T>) | (<F>));

        net compute
        {
		<?xml version="1.0"?>
		<metadata xmlns="snet-home.org" >
  	    	    <box name="sub" >
			<compiler>gcc</compiler>
			<compilerflags>-c -I. -I../../interfaces/C/</compilerflags>
			<boxsource>sub.c myfuns.c</boxsource>
  	    	    </box>
  	    	<box name="mult" >
			<compiler>gcc</compiler>
			<compilerflags>-c -I. -I../../interfaces/C/</compilerflags>
			<boxsource>mult.c myfuns.c</boxsource>
  	    	</box>
		</metadata>

                box sub( (x) -> (xx));
                box mult( (xm,rm) -> (rrm));
        }
        connect [{<F>,x,r} -> {xm=x,rm=r}; {x=x}] .. 
					(sub|mult) .. 
					  ([|{xx},{rrm} |]*{xx,rrm}) ..
					    [{xx,rrm}->{x=xx,r=rrm}];

}
connect (leq1 .. condif .. ([{<T>} -> {<stop>}] | compute))*{<stop>};
